<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Smart Factory</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	
	<!-- jquery and bootstrap 
	<script src="js/jquery.min.js" type="text/javascript"></script>
	<script src="/js/bootstrap.min.js" type="text/javascript"></script>
	<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	-->
	
	<!-- Dashboard -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
  	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />

	<link rel="stylesheet" type="text/css" href="/static/css/keen-dashboards.css" />
	
	<!-- xlsx -->
	<script lang="javascript" src="js/shim.min.js"></script>
	<script lang="javascript" src="js/xlsx.full.min.js"></script>
		
	<!-- sweetalert2 -->
	<script lang="javascript" src="js/sweetalert2.all.min.js"></script>
	<link rel="stylesheet" href="css/sweetalert2.min.css">
	
	<!-- Load D3.js -->
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<!-- Load billboard.js with style -->
	<script src="/static/js/billboard.js"></script>
	<link rel="stylesheet" href="/static/css/billboard.css">
	
	
	<script src="static/js/jquery.redirect.js" type="text/javascript"></script>
	
	<style type="text/css">
		table, td, th, tr{
			text-align: center;
			vertical-align: middle !important;
			border: 1px solid #d6d6d6;
			table-layout: fixed;
		}
		table.bb-tooltip td, table.bb-tooltip th, table.bb-tooltip tr{
			text-align: left;
		}
		.glyphicon-remove {
			color: red;
		}
		.glyphicon-ok {
			color: green;
		}
		.itemName {
			background-color: lightblue;
		}
		ul{
		   list-style:none;
		   padding-left: 15px;
	    }
	    .history {
	    	overflow: auto;
	    }
	    .addHistory {
	    	overflow: auto;
	    }
	    td, th, tr{
	    	height: 30px;
	    	min-width: 8px; 
		}
	    div.work {
	    	z-index: 1;
	    	position: absolute;
	    	overflow: hidden;
	    	box-sizing: border-box;
	    	border: 0px solid black;
	    	height: 30.4px;
	    	text-align: center;
	    }
	    .toolTipName, .toolTipValue {
	    	font-size: 13px;
	    	padding: 0px;
	    }
	    .toolTipTitle {
	    	margin-top: 0px;
	    	margin-bottom: 0px;
	    	
	    }
	    .modal-backdrop { 
		    background-color: transparent !important; 
		} 
		.chart-title {
			color: black !important;
			font-size: 18px !important;
			font-weight: 500 !important;
		}
		.dayWorkTable-nav {
			background-color: #428BCA; 
			border-color: #357ebd; 
			color: white ;
		}
		.dayWorkTable-nav .navbar-nav>.open>a{
			background-color: #357ebd !important;
			border-color: #357ebd; 
			color: black;
		}
	</style>
</head>
<body class="keen-dashboard" style="padding-top: 80px;">
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only"></span> 
					<span class="icon-bar"></span> <span class="icon-bar"></span> 
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../"> 
					<span class="glyphicon glyphicon-chevron-left"></span>
				</a> 
				<a class="navbar-brand" href="./output">작업 계획 확인</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-left hidden" id="linkNav">
					<li><a href="#top">비교 데이터 선택 버튼</a></li>
					<li><a href="#processNumTable">비교 그래프</a></li>
				</ul>
			</div>
		</div>
	</div>

	<div class="modal workInfo">
		<div class="modal-dialog modal-lg" style="position: absoulute;" id="toolTipDialog">
			<div class="modal-content" id="toolTipContent" style="width: 450px; ">
				<div class="modal-header" style="height: 50px; padding-left: 15px; padding-top: 15px">
    				<div class="modal-title">
     					<h3 class="toolTipTitle"></h3>
     				</div>
     			</div>
     			<div class="modal-body" style="padding: 10px;">
     				<table class="table table-striped" style="margin-bottom: 0px;">
				        <tbody>
				        	<tr class="toolTipNumber">
				        		<th></th>
				            </tr>
				            <tr class="toolTipItemName">
				                <th class="toolTipName">품목명</th>
				            </tr>
				            <tr class="toolTipProcessNum">
				                <th class="toolTipName">공정번호</th>
				            </tr>
				            <tr class="toolTipMachine">
				                <th class="toolTipName">배정기계</th>
				            </tr>
				            <tr class="toolTipStartTime">
				                <th class="toolTipName">시작시간</th>
				            </tr>
				            <tr class="toolTipEndTime">
				                <th class="toolTipName">종료시간</th>
				            </tr>
				            <tr class="toolTipProcessTime">
				                <th class="toolTipName">공정시간(분)</th>
				            </tr>
				            <tr class="toolTipResettingTime">
				                <th class="toolTipName">재셋팅시간(분)</th>
				            </tr>
				            <tr class="toolTipOrder">
				                <th class="toolTipName">주문자</th>
				            </tr>
				            <tr class="toolTipCount">
				                <th class="toolTipName">주문수량</th>
				            </tr>
				            <tr class="toolTipOrderNum">
				                <th class="toolTipName">주문번호</th>
				            </tr>
				        </tbody>
				    </table>
     			</div>
			</div>
		</div>
	</div>

	<div class="modal history">
		<div class="modal-dialog modal-lg">
			<div class="modal-content" style="left: -100px; width: 1000px;">
				<div class="modal-header">
    				<div class="modal-title">
     					<h3>작업 계획 기록</h3>
     				</div>
     			</div>
     			<div class="modal-body">
     				<div class="chart-stage hidden" id="historyListDiv">
						<table class="table table-bordered table-hover" id="historyList">
							<thead>
								<tr>
									<th>작업 계획 기록 파일명</th>
								</tr>
							</thead>
						</table>
					</div>
     				<div class="modal-body">
						<div class="hidden" id="historyDiv">
		   					<!-- Nav tabs -->
							<ul class="nav nav-tabs" role="tablist">
								<li class="active"><a href="#history_greedy_table" role="tab" data-toggle="tab">Greedy</a></li>
								<li><a href="#history_pso_table" role="tab" data-toggle="tab">PSO</a></li>
								<li><a href="#history_psopre_table" role="tab" data-toggle="tab">기존 PSO</a></li>
								<li><a href="#historyFooterDiv" role="menu" style="float: right;"><span class="caret"></span></a></li>
							</ul>
							<!-- Tab panes -->
							<div class="tab-content">
								<div class="tab-pane active" id="history_greedy_table">
									<div class="historyTable">
										<h3 class="historyTableTitle">Greedy Deadline</h3>
										<table class="table table-bordered table-striped" id="history_greedy_deadline">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">Greedy Priority</h3>
										<table class="table table-bordered table-striped" id="history_greedy_priority">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">Greedy Combination</h3>
										<table class="table table-bordered table-striped" id="history_greedy_combination">
										</table>
									</div>
								</div>
								<div class="tab-pane" id="history_pso_table">
									<div class="historyTable">
										<h3 class="historyTableTitle">PSO Deadline</h3>
										<table class="table table-bordered table-striped" id="history_pso_deadline">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">PSO Priority</h3>
										<table class="table table-bordered table-striped" id="history_pso_priority">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">PSO combination</h3>
										<table class="table table-bordered table-striped" id="history_pso_combination">
										</table>
									</div>
								</div>
								<div class="tab-pane" id="history_psopre_table">
									<div class="historyTable">
										<h3 class="historyTableTitle">기존 PSO Deadline</h3>
										<table class="table table-bordered table-striped" id="history_psopre_deadline">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">기존 PSO Priority</h3>
										<table class="table table-bordered table-striped" id="history_psopre_priority">
										</table>
									</div>
									<div class="historyTable">
										<h3 class="historyTableTitle">기존 PSO Combination</h3>
										<table class="table table-bordered table-striped" id="history_psopre_combination">
										</table>
									</div>
								</div>
							</div>
						</div>
	     			</div>
     			</div>
     			<div class="modal-footer" id="historyFooterDiv">
     				<button type="button" class="btn btn-primary" id="showHistoryBtn" style="float:left; margin-bottom: 10px;" onclick="showHistory()">작업 계획 기록 목록 갱신</button>
     				<button type="button" class="btn btn-primary" id="showModalAddHistoryBtn" style="float:left; margin-bottom: 10px;" onclick="showModalAddHistory()">작업 계획 기록 추가</button>
     				<button type="button" class="btn btn-primary hidden" id="visualizeBtn" style="margin-bottom: 10px;" onclick="visualize()">시각화</button>
     				<button type="button" class="btn btn-primary" id="closeHistoryBtn" style="margin-bottom: 10px;" onclick="closeHistory()">취소</button>
     			</div>
			</div>
		</div>
	</div>
	
	<div class="modal addHistory">
		<div class="modal-dialog modal-lg">
			<div class="modal-content"  style="left: -100px; width: 1000px;">
				<div class="modal-header">
    				<div class="modal-title">
    					<h3>작업 계획 기록 추가</h3>
     				</div>
     			</div>
     			<div class="modal-body">
					<input class="hidden" type="file" name="xlfile" id="xlf" />
					<div class="chart-stage hidden" id="workDiv">
	   					<!-- Nav tabs -->
						<ul class="nav nav-tabs" role="tablist">
							<li class="active"><a href="#greedy_table" role="tab" data-toggle="tab">Greedy</a></li>
							<li><a href="#pso_table" role="tab" data-toggle="tab">Pso</a></li>
							<li><a href="#psopre_table" role="tab" data-toggle="tab">기존 PSO</a></li>
							<li><a href="#addHistoryFooterDiv" role="menu" style="float: right;"><span class="caret"></span></a></li>
						</ul>
						
						<!-- Tab panes -->
						<div class="tab-content">
							<div class="tab-pane active" id="greedy_table">
								<div class="workTable">
									<h3 class="workTableTitle">Greedy Deadline</h3>
									<table class="table table-bordered table-striped" id="greedy_deadline">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">Greedy Priority</h3>
									<table class="table table-bordered table-striped" id="greedy_priority">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">Greedy Combination</h3>
									<table class="table table-bordered table-striped" id="greedy_combination">
									</table>
								</div>
							</div>
							<div class="tab-pane" id="pso_table">
								<div class="workTable">
									<h3 class="workTableTitle">PSO Deadline</h3>
									<table class="table table-bordered table-striped" id="pso_deadline">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">PSO Priority</h3>
									<table class="table table-bordered table-striped" id="pso_priority">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">PSO combination</h3>
									<table class="table table-bordered table-striped" id="pso_combination">
									</table>
								</div>
							</div>
							<div class="tab-pane" id="psopre_table">
								<div class="workTable">
									<h3 class="workTableTitle">기존 PSO Deadline</h3>
									<table class="table table-bordered table-striped" id="psopre_deadline">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">기존 PSO Priority</h3>
									<table class="table table-bordered table-striped" id="psopre_priority">
									</table>
								</div>
								<div class="workTable">
									<h3 class="workTableTitle">기존 PSO Combination</h3>
									<table class="table table-bordered table-striped" id="psopre_combination">
									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="hidden" id="out"></div>    				
     			</div>
     			<div class="modal-footer" id="addHistoryFooterDiv">
					<button type="button" class="btn btn-primary" id="replaceBtn1" style="margin-top: 10px; margin-bottom: 10px;" onclick="clickFileInput()">파일 선택 </button>
					<p style="display: inline-block;" id="replaceFileName1">선택된 파일 없음</p>
					<button type="button" class="btn btn-primary hidden" id="addHistoryBtn" style="margin-bottom: 5px;" onclick="addHistory()">기록 추가</button>     				
     				<button type="button" class="btn btn-primary" id="closeAddHistoryBtn" style="margin-bottom: 5px;" onclick="closeAddHistory()">취소</button>
     			</div>
			</div>
		</div>
	</div>
	
	<ul class="selectHistoryDiv">
		<li>
			<button type="button" class="btn btn-primary" id="selectHistoryBtn" style="margin-bottom: 10px;" onclick="selectHistory()">작업 계획 선택</button>
			<div class="btn-group-group hidden" id="btn-group" style="display:inline-block; margin-left: 15px;">
				<div class="btn-group greedy" data-toggle="buttons" style="margin-bottom: 10px;">
					<label class="btn btn-primary" onclick="setCompareDate('greedy', 'deadline', !$(this).children('input').prop('checked'), 0)">
						<input type="checkbox" name="btnForCompare" id="btnGreedyDeadline"> Greedy Deadline
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('greedy', 'priority', !$(this).children('input').prop('checked'), 1)">
						<input type="checkbox" name="btnForCompare" id="btnGreedyPriority"> Greedy Priority
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('greedy', 'combination', !$(this).children('input').prop('checked'), 2)">
						<input type="checkbox" name="btnForCompare" id="btnGreedyCombination"> Greedy Combination
					</label>
				</div>
				<div class="btn-group pso" data-toggle="buttons" style="margin-bottom: 10px;">
					<label class="btn btn-primary" onclick="setCompareDate('pso', 'deadline', !$(this).children('input').prop('checked'), 3)">
						<input type="checkbox" name="btnForCompare" id="btnPSODeadline"> PSO Deadline
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('pso', 'priority', !$(this).children('input').prop('checked'), 4)">
						<input type="checkbox" name="btnForCompare" id="btnPSOPriority"> PSO Priority
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('pso', 'combination', !$(this).children('input').prop('checked'), 5)">
						<input type="checkbox" name="btnForCompare" id="btnPSOCombination"> PSO Combination
					</label>
				</div>
				<div class="btn-group psopre" data-toggle="buttons" style="margin-bottom: 10px;">
					<label class="btn btn-primary" onclick="setCompareDate('psopre', 'deadline', !$(this).children('input').prop('checked'), 6)">
						<input type="checkbox" name="btnForCompare" id="btnPSOPreDeadline"> 기존 PSO Deadline
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('psopre', 'priority', !$(this).children('input').prop('checked'), 7)">
						<input type="checkbox" name="btnForCompare" id="btnPSOPrePriority"> 기존 PSO Priority
					</label>
					<label class="btn btn-primary" onclick="setCompareDate('psopre', 'combination', !$(this).children('input').prop('checked'), 8)">
						<input type="checkbox" name="btnForCompare" id="btnPSOPreCombination"> 기존 PSO Combination
					</label>
				</div>
			</div>
		</li>
	</ul>
	
	<div class="container-fluid" id="containerChart">
		<div class="row">
			<div class="col-sm-12" id="dayWorkTableLink">
				<div class="chart-wrapper">
					<div class="chart-title">기계별 하루 작업 계획</div>
					
					<div class="chart-stage">
						<div id="chart-stage">
							<div id="dayWorkTableDiv" class="hidden"> 
								<nav id="dayWorkTable-navbar" class="navbar navbar-default navbar-static dayWorkTable-nav" role="navigation" style="background-color: #428BCA; border-color: #357ebd; color: white;">
									<div class="container-fluid">
										<div class="navbar-header">
								        	<a class="navbar-brand" id="dayWorkTableCurState" style="width:220px; color:white;">Greedy_Deadline</a>
								        </div>
										<div class="collapse navbar-collapse dayWorkTableNavbar" style="padding: 0px;">
											<ul class="nav navbar-nav">
												<li class="dropdown">
													<a id="drop1" href="#" role="button" class="dropdown-toggle dayWorkTable-nav" data-toggle="dropdown" style="background-color: #428BCA; border-color: #357ebd; color: white;">Greedy<span class="caret"></span></a>
													<ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('greedy_deadline')">Deadline</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('greedy_priority')">Priority</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('greedy_combination')">Combination</a></li>
													</ul>
												</li>
												<li class="dropdown">
													<a href="#" id="drop2" role="button" class="dropdown-toggle dayWorkTable-nav" data-toggle="dropdown" style="background-color: #428BCA; border-color: #357ebd; color: white;">PSO<span class="caret"></span></a>
													<ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('pso_deadline')">Deadline</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('pso_priority')">Priority</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('pso_combination')">Combination</a></li>
													</ul>
												</li>
												<li id="fat-menu" class="dropdown">
													<a href="#" id="drop3" role="button" class="dropdown-toggle dayWorkTable-nav" data-toggle="dropdown" style="background-color: #428BCA; border-color: #357ebd; color: white;">기존 PSO<span class="caret"></span></a>
													<ul class="dropdown-menu" role="menu" aria-labelledby="drop3">
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('psopre_deadline')">Deadline</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('psopre_priority')">Priority</a></li>
														<li role="presentation"><a role="menuitem" tabindex="-1" onclick="createDayWorkTable('psopre_combination')">Combination</a></li>
													</ul>
												</li>
											</ul>
										</div>
									</div>
								</nav>
								<table class="table" id="hourHead">
									<tbody>
										<tr class="hours" >
											<th class="last" colspan="3">#</th>
											<th class="hour" colspan="6">0시</th>
											<th class="hour" colspan="6">1시</th>
											<th class="hour" colspan="6">2시</th>
											<th class="hour" colspan="6">3시</th>
											<th class="hour" colspan="6">4시</th>
											<th class="hour" colspan="6">5시</th>
											<th class="hour" colspan="6">6시</th>
											<th class="hour" colspan="6">7시</th>
											<th class="hour" colspan="6">8시</th>
											<th class="hour" colspan="6">9시</th>
											<th class="hour" colspan="6">10시</th>
											<th class="hour" colspan="6">11시</th>
											<th class="hour" colspan="6">12시</th>
											<th class="hour" colspan="6">13시</th>
											<th class="hour" colspan="6">14시</th>
											<th class="hour" colspan="6">15시</th>
											<th class="hour" colspan="6">16시</th>
											<th class="hour" colspan="6">17시</th>
											<th class="hour" colspan="6">18시</th>
											<th class="hour" colspan="6">19시</th>
											<th class="hour" colspan="6">20시</th>
											<th class="hour" colspan="6">21시</th>
											<th class="hour" colspan="6">22시</th>
											<th class="hour" colspan="6">23시</th>
											<th class="hour" colspan="6">24시</th>
										</tr>
									</tbody>
								</table>
							</div>				
							
						</div>
					 	<div class="chart-notes">24시간 동안의 각 기계들의 작업 계획, 색상은 주문번호에 따라 배정됩니다.</div>
					</div>
				</div>
			</div>
		</div>
		
		
		<div class="row">
			<div class="col-sm-12 ">
				<div class="chart-wrapper">
					<div class="chart-title">품목별 처리량 그래프</div>
					<div class="chart-stage">
						<table id="processNumTable" class="hidden" style="width: 100%">
							<thead>
								<tr>
									<th>품목별 공정횟수</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<div id="BarChartForItem"></div>
					</div>
					<div class="chart-notes">품목별 각 공정에 따른 처리량 그래프</div>
				</div>
			</div>
			
			<div class="col-sm-6">
				<div class="chart-wrapper">
					<div class="chart-title">기계별 처리시간 그래프</div>
					<div class="chart-stage">
						<div id="AreaChartForMachine"></div>
					</div>
					<div class="chart-notes">각 기계별 총 가동시간(분)</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="chart-wrapper">
					<div class="chart-title">주문자 별 처리 물량 그래프</div>
					<div class="chart-stage">
						<div id="AreaChartForOrder"></div>
					</div>
					<div class="chart-notes">주문자 별 총 처리 물량</div>
				</div>
			</div>
			
		</div>
	</div>
	<div class="container-fluid">
		<p class="small text-muted">
			Built by 팀추월
		</p>
	</div>

	<!-- script -->
	<script type="text/javascript">
	//data 
	var data = {};
	var dataByMachine = {};
	var dataByOrder = {};
	var dataByItem = {};
	var colorArray = [];
	var colorMap = new Map();
	
	var jsonData = {};
	var resultList = [];
	var columnName = [];
	
	var machineList = [];
	var orderList = [];
	var itemList = [];
	var precessList = {}; 
	
	var compareDataChecked = [null, null, null, null, null, null, null, null, null];
	
	var initialBtnGroup = function() {
		var inputs = $('.btn-group').find("input[name='btnForCompare']:checked");

		var buttons = $('.btn-group').find("input[name='btnForCompare']");
		for(var i = 0; i < buttons.length; i++) {
			$($(buttons[i]).parent()).attr("disabled", false);
		}
		
		for(var i = 0; i < inputs.length; i++) {
			$(inputs[i]).prop("checked", false);
			$($(inputs[i]).parent()).removeClass("active");
		}

		$("#AreaChartForMachine").children("svg").remove();
		$("#AreaChartForMachine").children("div.bb-tooltip-container").remove();

		$("#AreaChartForOrder").children("svg").remove();
		$("#AreaChartForOrder").children("div.bb-tooltip-container").remove();
		
		$("#BarChartForItem").children("svg").remove();
		$("#BarChartForItem").children("div.bb-tooltip-container").remove();
		
		$("div.btn-group-group").removeClass("hidden");
		
		$("#processNumTable").addClass("hidden");
	}
	
	
	var getCurState = function(key1, key2) {
		var curState = "";

		if(key1 == "psopre") {
			curState = "기존 PSO ";
		}
		else if(key1 == "pso") {
			curState = "PSO ";
		}
		else {
			curState = "Greedy ";
		}

		curState += key2.split("")[0].toUpperCase() + key2.substring(1, key2.length);
		
		return curState;
	}
	
	var makeGraphForItem = function(key1, key2) {
		//BarChartForItem
		var columnsData = [];

 		var x = ["x"];
		for(var j = 0; j < itemList.length; j++) {
			x.push(itemList[j]);
		}		
		columnsData.push(x);
		
		//processList;
		$("#processNumTable").removeClass("hidden");
		var processNumTableThead = $("#processNumTable").find("thead");
		processNumTableThead.find("th").attr("colspan", itemList.length);
		var processNumTableTbody = $("#processNumTable").find("tbody");
		processNumTableTbody.find("tr").remove();
		
		var processNumTableTr1 = $("<tr/>");
		var processNumTableTr2 = $("<tr/>");
		itemList.forEach(function(item) {
			var th = $("<th/>", {
				text: item
			});
			var td = $("<td/>", {
				text: precessList[item]
			});
			processNumTableTr1.append(th);
			processNumTableTr2.append(td);
			
		});
		processNumTableTbody.append(processNumTableTr1);
		processNumTableTbody.append(processNumTableTr2);
		
		for(var i = 0; i < key1.length; i++) {
			var numMax = 0;
			
			itemList.forEach(function(item) {
				if(dataByItem[key1[i]][key2[i]].hasOwnProperty(item)) {
					var len = dataByItem[key1[i]][key2[i]][item].processNumList.length;
					if(len > numMax) {
						numMax = len;
					}
				}
			});
									
			for(var j = 0; j < numMax; j++) {
				var column = [];
				column.push(getCurState(key1[i], key2[i]) + " " + (j + 1) + "번 공정");

				for(var k = 0; k < itemList.length; k++) {
					var totalTime = null;
					
					if(precessList[itemList[k]] < j + 1) {
						totalTime = null;
					}
					else {
						if(dataByItem[key1[i]][key2[i]].hasOwnProperty(itemList[k])) {
							if(dataByItem[key1[i]][key2[i]][itemList[k]].hasOwnProperty(j + 1)) {
								dataByItem[key1[i]][key2[i]][itemList[k]][j + 1].forEach(function(work) {
									totalTime += parseInt(work.orderNum);
								});
							}
						}
					}
					
					
					if(totalTime == -1) {
						column.push(null);
					}
					else {
						column.push(totalTime);						
					}
				}		
				
				columnsData.push(column);
			}
		}
		
		
		
		var chart = bb.generate({
			  data: {
				x: "x",
			    columns: columnsData,
			    type: "bar",
			    labels: true
			  },
			  axis: {
				  x: {
					  type: "category"
				  }
			  },
			  zoom: {
				enabled: true,
				rescale: true
			  },
			  bar: {
				padding: 3  
			  },
			  bindto: "#BarChartForItem"
			});
	}
	
	var makeGraphForOrder = function(key1, key2) {
		//AreaChartForOrder		
		var columnsData = [];
		var typeData = {};
		
		var x = ["x"];
		for(var j = 0; j < orderList.length; j++) {
			x.push(orderList[j]);
		}		
		columnsData.push(x);

		
		for(var i = 0; i < key1.length; i++) {

			if(i % 2 == 0) {
				typeData[getCurState(key1[i], key2[i])] = "area";
			}
			else {
				typeData[getCurState(key1[i], key2[i])] = "area-spline";				
			}

			var column = [];
			column.push(getCurState(key1[i], key2[i]));

			for(var j = 0; j < orderList.length; j++) {
				var totalTime = 0;
				if(dataByOrder[key1[i]][key2[i]].hasOwnProperty(orderList[j])) {
					dataByOrder[key1[i]][key2[i]][orderList[j]].forEach(function(work) {
						totalTime += parseInt(work.orderNum);
					});
				}		
				column.push(totalTime);
			}
			
			columnsData.push(column);
		}
				
		var chart = bb.generate({
			  data: {
				x: "x",
			    columns: columnsData,
			    types: typeData
			  },
			  axis: {
				  x: {
					  type: "category"
				  }
			  },
			  zoom: {
				enabled: true,
				rescale: true
			  },
			  bindto: "#AreaChartForOrder"
			});
	}
	
	var makeGraphForMachine = function(key1, key2) {
		//AreaChartForMachine		
		var columnsData = [];
		var typeData = {};
		
		var x = ["x"];
		for(var j = 0; j < machineList.length; j++) {
			x.push(machineList[j]);
		}		
		columnsData.push(x);
		
		for(var i = 0; i < key1.length; i++) {

			if(i % 2 == 0) {
				typeData[getCurState(key1[i], key2[i])] = "area";
			}
			else {
				typeData[getCurState(key1[i], key2[i])] = "area-spline";				
			}

			var column = [];
			column.push(getCurState(key1[i], key2[i]));

			for(var j = 0; j < machineList.length; j++) {
				var totalTime = 0;
				if(dataByMachine[key1[i]][key2[i]].hasOwnProperty(machineList[j])) {
					dataByMachine[key1[i]][key2[i]][machineList[j]].forEach(function(work) {
						totalTime += parseInt(work.processTime) + parseInt(work.resettingTime);
					});
				}		
				column.push(totalTime);
			}
			columnsData.push(column);
		}
		
		var chart = bb.generate({
			  data: {
				x: "x",
			    columns: columnsData,
			    types: typeData
			  },
			  zoom: {
				enabled: true,
				rescale: true
			  },
			  bindto: "#AreaChartForMachine"
			});
		
	}
	var makeGraph = function() {
		var key1 = [];
		var key2 = [];
		compareDataChecked.forEach(function(checked) {
			if(checked != null) {
				key1.push(checked.key1);
				key2.push(checked.key2);
			}
		});		
		
		makeGraphForMachine(key1, key2); 
		makeGraphForOrder(key1, key2);
		makeGraphForItem(key1, key2);
		
		
	}
	
	var setCompareDate = function(key1, key2, checked, index) {
		if(compareDataChecked[index] == null) {
			var tempJson = {};
			tempJson.key1 = key1;
			tempJson.key2 = key2;
			
			compareDataChecked[index] = tempJson;
		}
		else {
			compareDataChecked[index] = null;
		}
		makeGraph();			
	}
	
	var callToolTip = function(key1, key2, machineNum, gridsNum) {
		//투명도 조절
		var tr = $("#hourHead").find("tr.grids");
		for(var i = 0; i < tr.length; i++) {
			if(machineNum == $(tr[i]).find("th.machine").text()) {
				var eachTd = $(tr[i]).find("td.work"); 
				for(var j = 0; j < eachTd.length; j++){
					$(eachTd[j]).css({
							'opacity': '0.3'
					});
				}
				break;
			}
		}
		
		//tooltip
		var tooltip = $(".modal.workInfo").find("tbody");
		
		tooltip.find(".toolTipNumber").find("th.toolTipName").remove();
		tooltip.find(".toolTipItemName").find("td.toolTipValue").remove();
		tooltip.find(".toolTipProcessNum").find("td.toolTipValue").remove();
		tooltip.find(".toolTipMachine").find("td.toolTipValue").remove();
		tooltip.find(".toolTipStartTime").find("td.toolTipValue").remove();
		tooltip.find(".toolTipEndTime").find("td.toolTipValue").remove();
		tooltip.find(".toolTipProcessTime").find("td.toolTipValue").remove();
		tooltip.find(".toolTipResettingTime").find("td.toolTipValue").remove();
		tooltip.find(".toolTipOrder").find("td.toolTipValue").remove();
		tooltip.find(".toolTipCount").find("td.toolTipValue").remove();
		tooltip.find(".toolTipOrderNum").find("td.toolTipValue").remove();
		
		$(".modal.workInfo").modal({backdrop: 'static', keyboard: false});

		
		var th = $(tr[i]).find("th.machine");

		//37
		var top = $("#containerChart")[0].offsetTop + 38 + 5 + 77 + (37 * gridsNum);
		var left = 25 - $("#toolTipDialog")[0].offsetLeft; 
		if($("#toolTipDialog").css('left') >= '0px') {
			$("#toolTipDialog").css({
				'left': left + 'px'
			});
		}
	
		var workTr = $($("#hourHead").find("tr.grids")[gridsNum]).find("th.machine");
		$("#toolTipDialog").css({
			'top': top + "px"
		});
	
		$(".modal.workInfo").find(".toolTipTitle").text("기계번호: " + machineNum);
		
		for(var i = 0; i < dataByMachine[key1][key2][machineNum].length; i++) {
			var thNumber = $("<th/>", {
				text: dataByMachine[key1][key2][machineNum][i].number,
				class: "toolTipName"
			});
			thNumber.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdItemName = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].itemName
			});
			tdItemName.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdProcessNum = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].processNum
			});
			tdProcessNum.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdMachine = $("<td/>", {
				class: "toolTipValue",
				text: machineNum
			});
			tdMachine.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdStartTime = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].startTime
			});
			tdStartTime.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdEndTime = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].endTime
			});
			tdEndTime.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdProcessTime = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].processTime
			});
			tdProcessTime.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdResettingTime = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].resettingTime
			});
			tdResettingTime.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdOrder = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].order
			});
			tdOrder.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdCount = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].count
			});
			tdCount.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			var tdOrderNum = $("<td/>", {
				class: "toolTipValue",
				text: dataByMachine[key1][key2][machineNum][i].orderNum
			});
			tdOrderNum.css({
				'background-color': colorMap.get(dataByMachine[key1][key2][machineNum][i].orderNum)
			});
			
			tooltip.children(".toolTipNumber").append(thNumber);
			tooltip.children(".toolTipItemName").append(tdItemName);
			tooltip.children(".toolTipProcessNum").append(tdProcessNum);
			tooltip.children(".toolTipMachine").append(tdMachine);
			tooltip.children(".toolTipStartTime").append(tdStartTime);
			tooltip.children(".toolTipEndTime").append(tdEndTime);
			tooltip.children(".toolTipProcessTime").append(tdProcessTime);
			tooltip.children(".toolTipResettingTime").append(tdResettingTime);
			tooltip.children(".toolTipOrder").append(tdOrder);
			tooltip.children(".toolTipCount").append(tdCount);
			tooltip.children(".toolTipOrderNum").append(tdOrderNum);
			
		}
	}
	var compareInt = function(a, b) {
		return parseInt(a) - parseInt(b);
	}
	
	var makeDataByCondition = function() {		
		//초기화
		data = {};
		dataByMachine = {};
		dataByOrder = {};
		dataByItem = {};

		machineList = [];
		orderList = [];
		compareDataChecked = [null, null, null, null, null, null, null, null, null];
		
		var keyArray1 = [];
		keyArray1.push("greedy");
		keyArray1.push("pso");
		keyArray1.push("psopre");

		var keyArray2 = [];
		keyArray2.push("deadline");
		keyArray2.push("priority");
		keyArray2.push("combination");
		
		//color Map
		colorMap = new Map();
		var colorIndex = 0;
		
		//machineList
		var machineMap = new Map();
		//orderList
		var orderMap = new Map();
		//itemList
		var itemMap = new Map();
		//processList
		var processMap = new Map();
		
		keyArray1.forEach(function(key1) {
			data[key1] = {};
			dataByMachine[key1] = {};
			dataByOrder[key1] = {};
			dataByItem[key1] = {};
			
		    keyArray2.forEach(function(key2) {
		    	var resultList = jsonData[key1][key2].resultList;
		    	var eachData = {};
		    	var eachDataByMachine = {};
		    	var eachDataByOrder = {};
		    	var eachDataByItem = {};
		        	    	
		    	resultList.forEach(function(each) {
		    	    var eachJson = {};
		    	    var eachArray = [];
					
		    	    //data
		    	    eachJson = {};
		    	    eachArray = [];
		    	    eachJson.itemName = each["품목명"];
		    	    eachJson.processNum = each["공정번호"];
		    	    eachJson.machine = each["배정기계"];
		    	    eachJson.startTime = each["시작시간"];
		    	    eachJson.endTime = each["종료시간"];
		    	    eachJson.processTime = each["공정시간"];
		    	    eachJson.resettingTime = each["재셋팅시간"];
		    	    eachJson.order = each["주문자"];
		    	    eachJson.count = each["주문수량"];
		    	    eachJson.orderNum = each["주문번호"];
		    	    
		    	    eachData[each["작업번호"]] = eachJson;
		    	    if(!eachData.hasOwnProperty("numberList")) {
		    	        eachData.numberList = eachArray;
		    	    }
		    	    eachData.numberList.push(each["작업번호"]);				
		    	    
		    	    //eachDataByMachine
		    	    eachJson = {};
		    	    eachArray = [];
		    	    eachJson.itemName = each["품목명"];
		    	    eachJson.processNum = each["공정번호"];
		    	    eachJson.number = each["작업번호"];
		    	    eachJson.startTime = each["시작시간"];
		    	    eachJson.endTime = each["종료시간"];
		    	    eachJson.processTime = each["공정시간"];
		    	    eachJson.resettingTime = each["재셋팅시간"];
		    	    eachJson.order = each["주문자"];
		    	    eachJson.count = each["주문수량"];
		    	    eachJson.orderNum = each["주문번호"];
		    	    
		    	    if(!eachDataByMachine.hasOwnProperty(each["배정기계"])){
		    	        eachDataByMachine[each["배정기계"]] = eachArray;
		    	    }
		    	    eachDataByMachine[each["배정기계"]].push(eachJson);

		    	    if(!eachDataByMachine.hasOwnProperty("machineList")) {
		    	        eachArray = [];
		    	        eachDataByMachine.machineList = eachArray;
		    	    }
		    	    if(-1 == eachDataByMachine.machineList.indexOf(each["배정기계"])) {
		    	        eachDataByMachine.machineList.push(each["배정기계"]);								
		    	    }
		    	    if(!machineMap.has(each["배정기계"])) {
		    	    	machineMap.set(each["배정기계"], true);
		    	    }
		    	    
		    	    //eachDataByOrder
		    	    eachJson = {};
		    	    eachArray = [];
		    	    eachJson.itemName = each["품목명"];
		    	    eachJson.processNum = each["공정번호"];
		    	    eachJson.number = each["작업번호"];
		    	    eachJson.startTime = each["시작시간"];
		    	    eachJson.endTime = each["종료시간"];
		    	    eachJson.processTime = each["공정시간"];
		    	    eachJson.resettingTime = each["재셋팅시간"];
		    	    eachJson.machine = each["배정기계"];
		    	    eachJson.count = each["주문수량"];
		    	    eachJson.orderNum = each["주문번호"];
		    	    
		    	    if(!eachDataByOrder.hasOwnProperty(each["주문자"])){
		    	        eachDataByOrder[each["주문자"]] = eachArray;
		    	    }
		    	    eachDataByOrder[each["주문자"]].push(eachJson);

		    	    if(!eachDataByOrder.hasOwnProperty("orderList")) {
		    	        eachArray = [];
		    	        eachDataByOrder.orderList = eachArray;
		    	    }
		    	    if(-1 == eachDataByOrder.orderList.indexOf(each["주문자"])) {
		    	        eachDataByOrder.orderList.push(each["주문자"]);				
		    	    }
		    	    if(!orderMap.has(each["주문자"])) {
		    	    	orderMap.set(each["주문자"], true);
		    	    }
		    	    
		    	    //eachDataByItem
		    	    eachJson = {};
		    	    eachArray = [];
		    	    eachJson.order = each["주문자"];
		    	    eachJson.number = each["작업번호"];
		    	    eachJson.startTime = each["시작시간"];
		    	    eachJson.endTime = each["종료시간"];
		    	    eachJson.processTime = each["공정시간"];
		    	    eachJson.resettingTime = each["재셋팅시간"];
		    	    eachJson.machine = each["배정기계"];
		    	    eachJson.count = each["주문수량"];
		    	    eachJson.orderNum = each["주문번호"];

		    	    if(eachDataByItem.hasOwnProperty(each["품목명"])){
		    	        if(!eachDataByItem[each["품목명"]].hasOwnProperty(each["공정번호"])){
		    	            eachDataByItem[each["품목명"]][each["공정번호"]] = eachArray;
		    	        }	
		    	        eachDataByItem[each["품목명"]][each["공정번호"]].push(eachJson);
		    	    }
		    	    else {
		    	        eachArray.push(eachJson);
		    	        var tempJson = {};
		    	        tempJson[each["공정번호"]] = eachArray; 
		    	        eachDataByItem[each["품목명"]] = tempJson;
		    	    }

		    	    if(!eachDataByItem.hasOwnProperty("itemList")) {
		    	        eachArray = [];
		    	        eachDataByItem.itemList = eachArray;
		    	    }
		    	    if(-1 == eachDataByItem.itemList.indexOf(each["품목명"])) {
		    	        eachDataByItem.itemList.push(each["품목명"]);				
		    	    }
		    	    
		    	    if(!eachDataByItem[each["품목명"]].hasOwnProperty("processNumList")) {
		    	        eachArray = [];
		    	        eachDataByItem[each["품목명"]].processNumList = eachArray; 
		    	    }
		    	    if(-1 == eachDataByItem[each["품목명"]].processNumList.indexOf(each["공정번호"])) {
		    	        eachDataByItem[each["품목명"]].processNumList.push(each["공정번호"]);
		    	    }
		    	    
		    	    if(!colorMap.has(each["주문번호"])) {
		    	    	colorMap.set(each["주문번호"], colorArray[colorIndex]);
			    	    colorIndex++;
		    	    }
		    	    if(colorIndex == colorArray.length) {
		    	    	colorIndex = 0;
		    	    }
		    	    if(!itemMap.has(each["품목명"])) {
		    	    	itemMap.set(each["품목명"], true);
		    	    }
		    	    if(!processMap.has(each["품목명"])) {
		    	    	processMap.set(each["품목명"], parseInt(each["공정번호"]));
		    	    }
		    	    else {
						if(processMap.get(each["품목명"]) < parseInt(each["공정번호"])) {
							processMap.set(each["품목명"], parseInt(each["공정번호"]));
						}    	    	
		    	    }
		    	});
		        
		    	//sort
		    	eachData.numberList.sort(compareInt);
		    	eachDataByMachine.machineList.sort(compareInt);
		    	eachDataByOrder.orderList.sort();
		    	eachDataByItem.itemList.sort();
		    	
		    	data[key1][key2] = eachData;
		    	dataByMachine[key1][key2] = eachDataByMachine;
		    	dataByOrder[key1][key2] = eachDataByOrder;
		    	dataByItem[key1][key2] = eachDataByItem;
		    	
		    	
		    });
		});
		
		var iterator1 = machineMap[Symbol.iterator]();
		var iterator2 = orderMap[Symbol.iterator]();
		var iterator3 = itemMap[Symbol.iterator]();
		var iterator4 = processMap[Symbol.iterator]();
		
		for (var item of iterator1) {
			machineList.push(parseInt(item[0]));
		}
		for (var item of iterator2) {
			orderList.push(item[0]);
		}
		for (var item of iterator3) {
			itemList.push(item[0]);
		}
		for (var item of iterator4) {
			precessList[item[0]] = item[1];
		}
		machineList.sort(compareInt);
		orderList.sort();
		itemList.sort();
		
	}
			
	var createDayWorkTable = function(str) {
		var key1 = str.split("_")[0];
		var key2 = str.split("_")[1];
		
		$("#dayWorkTableCurState").text(getCurState(key1, key2));
				
		//remove
		$("#hourHead").children("tbody").find("tr.grids").remove();
		
		var workArray = [];
		
		//work 생성
		data[key1][key2].numberList.forEach(function(number) {
			var work = {};

			work.text = number;
			work.color = colorMap.get(data[key1][key2][number].orderNum);
			work.machineNum = data[key1][key2][number].machine;
			work.time = parseInt(data[key1][key2][number].processTime) + parseInt(data[key1][key2][number].resettingTime); 
			work.number = number;
			
			workArray.push(work);
		});
		//기계별로 작업 분배
		var workMahcineArray = [];
		for(var i = 0;  i < dataByMachine[key1][key2].machineList.length; i++) {
			var temp = [];
			workMahcineArray.push(temp);
		}

		workArray.forEach(function(work) {
			workMahcineArray[dataByMachine[key1][key2].machineList.indexOf(work.machineNum)].push(work);
		});

		var curTime = 0;
		
		//1110 => 11시 10분
		for(var i = 0; i < dataByMachine[key1][key2].machineList.length; i++) {
			var tbody = $("#hourHead").children("tbody");
			
			var grids = $("<tr/>", {
				class: "grids"
			});
			var th = $("<th/>", {
				class: "machine",
				text: dataByMachine[key1][key2].machineList[i],
				colspan: 6,
				onmouseenter: "callToolTip('" + key1 + "', '" + key2 + "', " + dataByMachine[key1][key2].machineList[i] +"," + i + ")"
			});
			grids.append(th);
			
			//work
			var totalWorkTime = 0;
			workMahcineArray[i].forEach(function(work) {
				var timeTenMinutes = work.time / 10; 
				var tdWork = $("<td/>", {
					class: "work",
					text: work.text,
					colspan: timeTenMinutes
				});
				tdWork.css({
					'background-color': work.color
				});
				grids.append(tdWork);
				
				totalWorkTime += timeTenMinutes;
			});
			
			for(var j = 1; j <= ((24 * 6) - totalWorkTime) % 6; j++) {
				var td = $("<td/>", {
					class: "grid"
				});
				grids.append(td);				
			}
			
			for(var j = 1; j <= ((24 * 6) - totalWorkTime) / 6; j++) {
				var td = $("<td/>", {
					class: "last",
					colspan: 6
				});
				grids.append(td);
			}
			//work end
			
			var last = $("<th/>", {
				class: "last",
				colspan: 3
			});
			grids.append(last);
			tbody.append(grids);
		
		}		
	}
	
	var destroyDayWorkTable = function() {
		$("div.work").remove();
		$(".grids").remove();
		
	} 
	
	var makeDayWorkTable = function() {
		destroyDayWorkTable();
		//grid
		createDayWorkTable('greedy_deadline');
		
		$("#dayWorkTableDiv").removeClass("hidden");
	}
	
	var visualize = function() {
		closeHistory();
		
		//data 생성
		makeDataByCondition();
		
		//시각화 차트들 다 갱신
		makeDayWorkTable();
		
		//비교 차트 버튼 
		initialBtnGroup();
		
		//link 
		$("#linkNav").removeClass("hidden");
	}
	// chart end
		
	var showModalAddHistory = function() {
		$(".modal.addHistory").modal({backdrop: 'static', keyboard: false});
	}
	var closeAddHistory = function() {
		$("#greedy_deadline").find("thead").remove();
		$("#greedy_deadline").find("tbody").remove();
		$("#greedy_priority").find("thead").remove();
		$("#greedy_priority").find("tbody").remove();
		$("#greedy_combination").find("thead").remove();
		$("#greedy_combination").find("tbody").remove();
		$("#pso_deadline").find("thead").remove();
		$("#pso_deadline").find("tbody").remove();
		$("#pso_priority").find("thead").remove();
		$("#pso_priority").find("tbody").remove();
		$("#pso_combination").find("thead").remove();
		$("#pso_combination").find("tbody").remove();
		$("#psopre_deadline").find("thead").remove();
		$("#psopre_deadline").find("tbody").remove();
		$("#psopre_priority").find("thead").remove();
		$("#psopre_priority").find("tbody").remove();
		$("#psopre_combination").find("thead").remove();
		$("#psopre_combination").find("tbody").remove();
		
		$("#workDiv").addClass("hidden");

		$(".modal.addHistory").modal('hide');
	}
	var selectHistory = function() {
		$(".modal.history").modal({backdrop: 'static', keyboard: false});
	}
	var closeHistory = function() {
		$("#visualizeBtn").addClass("hidden");
		$("#historyListDiv").addClass('hidden');
 		$("#historyList").find("tbody").remove();
 		$("#historyDiv").addClass("hidden");		
		
		var tableArray = [];
		tableArray.push("history_greedy_deadline");
		tableArray.push("history_greedy_priority");
		tableArray.push("history_greedy_combination");
		tableArray.push("history_pso_deadline");
		tableArray.push("history_pso_priority");
		tableArray.push("history_pso_combination");
		tableArray.push("history_psopre_deadline");
		tableArray.push("history_psopre_priority");
		tableArray.push("history_psopre_combination");
		
		for(var tableIndex = 0; tableIndex < tableArray.length; tableIndex++) {
			$("#" + tableArray[tableIndex]).find("thead").remove();			
			$("#" + tableArray[tableIndex]).find("tbody").remove();			
		}

		$(".modal.history").modal('hide');
	}
	var callHistory = function(fileName) {
		$("#historyDiv").addClass("hidden");
		
		var tableArray = [];
		tableArray.push("history_greedy_deadline");
		tableArray.push("history_greedy_priority");
		tableArray.push("history_greedy_combination");
		tableArray.push("history_pso_deadline");
		tableArray.push("history_pso_priority");
		tableArray.push("history_pso_combination");
		tableArray.push("history_psopre_deadline");
		tableArray.push("history_psopre_priority");
		tableArray.push("history_psopre_combination");
		
		for(var tableIndex = 0; tableIndex < tableArray.length; tableIndex++) {
			$("#" + tableArray[tableIndex]).find("thead").remove();			
			$("#" + tableArray[tableIndex]).find("tbody").remove();			
		}
		
		$.ajax({
			url: "/callHistory",
			type: "POST",
			dataType: "JSON",
			data: {fileName: fileName},
			complete: function(response) {
				jsonData = response.responseJSON;
				
				var keyArray1 = [];
				keyArray1.push("greedy");
				keyArray1.push("pso");
				keyArray1.push("psopre");
				
				var keyArray2 = [];
				keyArray2.push("deadline");
				keyArray2.push("priority");
				keyArray2.push("combination");
				
				keyArray1.forEach(function(key1) {
					keyArray2.forEach(function(key2) {
						var resultList = response.responseJSON[key1][key2].resultList;
						var columnName = response.responseJSON[key1][key2].columnName;
						
						
						var thead = $("<thead/>");
						var theadTr = $("<tr/>");
						
						columnName.forEach(function(name) {
							var th = $("<th/>", {
								text: name
							});
							theadTr.append(th);
						});
						thead.append(theadTr);
						$("#history_" + key1 + "_" + key2).append(thead);

						var tbody = $("<tbody/>");
						resultList.forEach(function(work) {
							var tr = $("<tr/>");
							columnName.forEach(function(name) {
								var td = $("<td/>", {
									text: work[name]
								})
								tr.append(td);
							});
							tbody.append(tr);
						});
						$("#history_" + key1 + "_" + key2).append(tbody);
					});
				}); 
								
				$("#historyDiv").removeClass("hidden");
				
				$("#visualizeBtn").removeClass("hidden");
			}
		});
	}
	
	var addHistory = function() {
		var date = new Date();
		var fileName = date.getFullYear().toString() + (date.getMonth() + 1).toString() + date.getDate().toString() 
			+ "_" + date.getHours().toString() + date.getMinutes().toString() + date.getSeconds().toString();

		$.ajax({
			url: "/addHistory",
			type: "POST",
			dataType: "JSON",
			data: {resultList: jsonData, fileName: fileName},
			success: function(response) {
				swal(response.success, "작업 계획이 기록되었습니다.", "success");
				closeAddHistory();
			}, error: function(reqeuse, status, error) {
				swal(response.error, "기록에 실패하였습니다. 다시 시도해 주십시오.", "error")
			}
		});
		
	}
 	var showHistory = function() {
 		//table 초기화
 		$("#visualizeBtn").addClass("hidden");
		$("#historyListDiv").addClass('hidden');
 		$("#historyList").find("tbody").remove();
 		$("#historyDiv").addClass("hidden");		
		
		var tableArray = [];
		tableArray.push("history_greedy_deadline");
		tableArray.push("history_greedy_priority");
		tableArray.push("history_greedy_combination");
		tableArray.push("history_pso_deadline");
		tableArray.push("history_pso_priority");
		tableArray.push("history_pso_combination");
		tableArray.push("history_psopre_deadline");
		tableArray.push("history_psopre_priority");
		tableArray.push("history_psopre_combination");
		
		for(var tableIndex = 0; tableIndex < tableArray.length; tableIndex++) {
			$("#" + tableArray[tableIndex]).find("thead").remove();			
			$("#" + tableArray[tableIndex]).find("tbody").remove();			
		}
				
 		$.ajax({
			url: "/readHistoryList",
			type: "POST",
			dataType: "JSON",
			complete: function(response) {
				var array = response.responseJSON.fileNames;				
				
				var tbody = $("<tbody/>");
				
				array.forEach(function(fileName) {
					var tr = $("<tr/>");
					var td = $("<td/>", {
						text: fileName
					});
					
					td.attr('onClick', 'callHistory($(this).text())');
					
					tr.append(td);
					tbody.append(tr);
				})
				$("#historyList").append(tbody);
				
				$("#historyListDiv").removeClass('hidden');
				
			}
		});
	} 
	
	var clickFileInput = function() {
		$('input[name="xlfile"]').click();
		
	}	

	var fillTableWork = function(sheets) {
		jsonData = {};
		jsonData.greedy = {};
		jsonData.pso = {};
		jsonData.psopre = {};

		var sheetArray = [];
		sheetArray.push("greedy_deadline");
		sheetArray.push("greedy_priority");
		sheetArray.push("greedy_combination");
		sheetArray.push("pso_deadline");
		sheetArray.push("pso_priority");
		sheetArray.push("pso_combination");
		sheetArray.push("psopre_deadline");
		sheetArray.push("psopre_priority");
		sheetArray.push("psopre_combination");

		for(var sheetNum = 0; sheetNum < sheetArray.length; sheetNum++) {			
			var addressNum = 1;
			var addressAlpabet = 65; // A
			var address = String.fromCharCode(addressAlpabet) + addressNum;
			
			var table = $("#" + sheetArray[sheetNum]);
			
			var thead = $("<thead/>");
			var tr = $("<tr/>", {
				class: "workTableHead"
			});
			
			//json
			var columnName = [];
			var resultList = [];
			
			while(sheets[sheetArray[sheetNum]][address] != undefined) {
				var th = $("<th/>", {
					text: sheets[sheetArray[sheetNum]][address].w
				});
				tr.append(th);
				
				//json
				columnName.push(sheets[sheetArray[sheetNum]][address].w);
				
				addressAlpabet++;
				address = String.fromCharCode(addressAlpabet) + addressNum;
			}
			thead.append(tr);
			table.append(thead);
			
			var tbody = $("<tbody/>");
			
			addressNum++;
			addressAlpabet = 65;
			address = String.fromCharCode(addressAlpabet) + addressNum;
			
			while(sheets[sheetArray[sheetNum]][address] != undefined) {
				var tr = $("<tr/>");
				
				//json
				var columnNum = 0;
				var row = {};
				
				while(sheets[sheetArray[sheetNum]][address] != undefined) {
					var td = $("<td/>", {
						text: sheets[sheetArray[sheetNum]][address].w
					});
					
					//json
					row[columnName[columnNum]] = sheets[sheetArray[sheetNum]][address].w; 
					columnNum++;
					
					tr.append(td);
					addressAlpabet++;
					address = String.fromCharCode(addressAlpabet) + addressNum;
					
				}
				//json
				resultList.push(row);
				
				tbody.append(tr);
				
				addressNum++;
				addressAlpabet = 65;
				address = String.fromCharCode(addressAlpabet) + addressNum;
			}
			
			//json
			var tempjson = {};
			tempjson.resultList = resultList;
			tempjson.columnName = columnName;
			
			jsonData[sheetArray[sheetNum].split("_")[0]][sheetArray[sheetNum].split("_")[1]] = tempjson;

			table.append(tbody);			
		}
	}
	
	var X = XLSX;
	var XW = {
		/* worker message */
		msg: 'xlsx',
		/* worker scripts */
		worker: 'js/xlsxworker.js'
	};
	
	var global_wb;
	
	var process_wb = (function() {
		var OUT = document.getElementById('out');
		
		var get_format = (function() {
			var radios = document.getElementsByName( "format" );
			return function() {
				for(var i = 0; i < radios.length; ++i) if(radios[i].checked || radios.length === 1) return radios[i].value;
			};
		})();
	
		var to_json = function to_json(workbook) {
			var result = {};
			workbook.SheetNames.forEach(function(sheetName) {
				var roa = X.utils.sheet_to_json(workbook.Sheets[sheetName], {header:1});
				if(roa.length) result[sheetName] = roa;
			});
			return JSON.stringify(result, 2, 2);
		};
	
		var to_csv = function to_csv(workbook) {
			var result = [];
			workbook.SheetNames.forEach(function(sheetName) {
				var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
				if(csv.length){
					result.push("SHEET: " + sheetName);
					result.push("");
					result.push(csv);
				}
			});
			return result.join("\n");
		};
	
		var to_fmla = function to_fmla(workbook) {
			var result = [];
			workbook.SheetNames.forEach(function(sheetName) {
				var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
				if(formulae.length){
					result.push("SHEET: " + sheetName);
					result.push("");
					result.push(formulae.join("\n"));
				}
			});
			return result.join("\n");
		};
	
		
		return function process_wb(wb) {
			global_wb = wb;
			var output = "";
			switch(get_format()) {
				case "form": output = to_fmla(wb); break;
				case "html": output = to_html(wb); break;
				case "json": output = to_json(wb); break;
				default: output = to_csv(wb);
			}
			if(OUT.innerText === undefined) OUT.textContent = output;
			else OUT.innerText = output;
			if(typeof console !== 'undefined') console.log("output", new Date());
		};
	})();
	
	
	
	var do_file = (function() {
		var rABS = typeof FileReader !== "undefined" && (FileReader.prototype||{}).readAsBinaryString;
		var domrabsChecked = true;
		var use_worker = typeof Worker !== 'undefined';
		var domworkChecked = true;
	
		var xw = function xw(data, cb) {
			
			var worker = new Worker(XW.worker);
			worker.onmessage = function(e) {
				switch(e.data.t) {
					case 'ready': break;
					case 'e': console.error(e.data.d); break;
					case XW.msg: 
						cb(JSON.parse(e.data.d));
						//this is data
						fillTableWork(JSON.parse(e.data.d).Sheets);
						
						
						var obj_s = JSON.stringify(JSON.parse(e.data.d), null, "\t");

			            var dataUri = "data:application/json;charset=utf-8,"+ encodeURIComponent(obj_s);
        			    var link = $("#link").attr("href", dataUri);

						swal("Excel 읽기 완료!", "아래 표에서 데이터를 확인하고 기록 추가 버튼을 눌려주세요.", "success")
						
						$("#addHistoryBtn").removeClass("hidden");
						$("#workDiv").removeClass("hidden");
						break;
				}	
			};
			worker.postMessage({d:data,b:rABS?'binary':'array'});
		};
	
		return function do_file(files) {
			rABS = domrabsChecked;
			use_worker = domworkChecked;
			var f = files[0];
			var reader = new FileReader();
			reader.onload = function(e) {
				if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
				var data = e.target.result;
				if(!rABS) data = new Uint8Array(data);
				if(use_worker) xw(data, process_wb);
				else process_wb(X.read(data, {type: rABS ? 'binary' : 'array'}));
			};
			if(rABS) reader.readAsBinaryString(f);
			else reader.readAsArrayBuffer(f);
		};
	})();
	
	
	(function() {
		$.ajax({
			url: "/getColorTable",
			type: "POST",
			dataType: "JSON",
			complete: function(response) {
				colorArray = response.responseJSON.colorArray;
			}
		});
		
		$('input[name="btnForCompare"]').change(function() {
			var number = $('.btn-group').find("input[name='btnForCompare']:checked").length;
			var inputs = $('.btn-group').find("input[name='btnForCompare']:not(:checked)");
			if (number > 2) {
				for(var i = 0; i < inputs.length; i++) {
					$($(inputs[i]).parent()).attr("disabled", true);
				}
			}else {
				for(var i = 0; i < inputs.length; i++) {
					($(inputs[i]).parent()).attr("disabled", false);
				}
			}
		});
		
		$("#toolTipContent").mouseleave(function(){
			//투명도 조절
			var title = $(".modal.workInfo").find("h3.toolTipTitle").text();
			var machineNum = title.split(": ")[1]; 
			
			var tr = $("#hourHead").find("tr.grids");
			for(var i = 0; i < tr.length; i++) {
				if(machineNum == $(tr[i]).find("th.machine").text()) {
					var eachTd = $(tr[i]).find("td.work"); 
					for(var j = 0; j < eachTd.length; j++){
						$(eachTd[j]).css({
								'opacity': '1'
						});
					}
					break;
				}
			}

			$(".modal.workInfo").modal('hide');			
		});
		
		var xlf = document.getElementById('xlf');
		if(!xlf.addEventListener) return;
		function handleFile(e) { 
			//loading 표시
			swal({
				title: 'Loading...',
				imageUrl: 'static/img/loading.gif',
				imageSize: '400x400',
				imageAlt: 'Custom image',
				animation: false
			});
			
			//file name 표시.
			$('p#replaceFileName1').text(e.target.files[0].name);
			
			//file 선택 후 replaceBtn에 선택된 파일 이름 표기 및 버튼 색상 변경
			$('button#replaceBtn1').text(e.target.files.name)
			
			do_file(e.target.files); 
		}
		xlf.addEventListener('change', handleFile, false);
	})();
	
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-36810333-1']);
	_gaq.push(['_trackPageview']);
	
	</script>
</body>
</html>