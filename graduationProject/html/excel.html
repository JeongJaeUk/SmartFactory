<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Smart Factory</title>
	<meta http-equiv="Content-Type" content="text/html;" />
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />

	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	
	<!-- Demo Dependencies -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/holder/2.3.2/holder.min.js" type="text/javascript"></script>
	<script>
		Holder.add_theme("white", { background:"#fff", foreground:"#a7a7a7", size:10 }); 
	</script>
	
	<!-- keen-analysis@1.2.2 -->
	<script src="https://d26b395fwzu5fz.cloudfront.net/keen-analysis-1.2.2.js" type="text/javascript"></script>
	
	<!-- keen-dataviz@1.1.3 -->
	<link href="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.css" rel="stylesheet" />
	<script src="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.js" type="text/javascript"></script>
	
	<!-- Dashboard -->
	<link rel="stylesheet" type="text/css" href="/resources/css/keen-dashboards.css" />
</head>
<body class="keen-dashboard" style="padding-top: 80px;">
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../"> <span
					class="glyphicon glyphicon-chevron-left"></span>
				</a> <a class="navbar-brand" href="./">결과 페이지</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-left">
					<li><a href="../excel">Excel 파일</a></li>
					<li><a href="../about">about</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div>
		<input type="file" name="xlfile" id="xlf" />
	</div>
	<div id="out"></div>
	<br />

	<div>
		<hr>
		<p class="small text-muted">
			Built with TeamOvertake</a>
		</p>
	</div>

	<!-- script -->
	<script src="bower/bootstrap-sweetalert/dist/sweetalert.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	
	<script src="bower/js-xlsx/shim.js"></script>
	<script src="bower/js-xlsx/jszip.js"></script>
	<script src="bower/js-xlsx/xlsx.js"></script>

	<!-- Project Analytics -->
	<script type="text/javascript" src="/resources/js/keen-analytics.js"></script>

	<script>
		/*jshint browser:true */
		/* eslint-env browser */
		/*global Uint8Array, console */
		/*global XLSX */
		/* exported b64it, setfmt */
		/* eslint no-use-before-define:0 */
		var X = XLSX;
		var XW = {
			/* worker message */
			msg: 'xlsx',
			/* worker scripts */
			worker: 'bower/js-xlsx/xlsxworker.js'
		};
		
		var global_wb;
		
		var process_wb = (function() {
			var OUT = document.getElementById('out');
			var HTMLOUT = document.getElementById('htmlout');
		
			var get_format = (function() {
				var radios = document.getElementsByName( "format" );
				return function() {
					for(var i = 0; i < radios.length; ++i) if(radios[i].checked || radios.length === 1) return radios[i].value;
				};
			})();
		
			var to_json = function to_json(workbook) {
				var result = {};
				workbook.SheetNames.forEach(function(sheetName) {
					var roa = X.utils.sheet_to_json(workbook.Sheets[sheetName], {header:1});
					if(roa.length) result[sheetName] = roa;
				});
				return JSON.stringify(result, 2, 2);
			};
		
			var to_csv = function to_csv(workbook) {
				var result = [];
				workbook.SheetNames.forEach(function(sheetName) {
					var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
					if(csv.length){
						result.push("SHEET: " + sheetName);
						result.push("");
						result.push(csv);
					}
				});
				return result.join("\n");
			};
		
			var to_fmla = function to_fmla(workbook) {
				var result = [];
				workbook.SheetNames.forEach(function(sheetName) {
					var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
					if(formulae.length){
						result.push("SHEET: " + sheetName);
						result.push("");
						result.push(formulae.join("\n"));
					}
				});
				return result.join("\n");
			};
		
			var to_html = function to_html(workbook) {
				HTMLOUT.innerHTML = "";
				workbook.SheetNames.forEach(function(sheetName) {
					var htmlstr = X.write(workbook, {sheet:sheetName, type:'string', bookType:'html'});
					HTMLOUT.innerHTML += htmlstr;
				});
				return "";
			};
		
			return function process_wb(wb) {
				global_wb = wb;
				var output = "";
				switch(get_format()) {
					case "form": output = to_fmla(wb); break;
					case "html": output = to_html(wb); break;
					case "json": output = to_json(wb); break;
					default: output = to_csv(wb);
				}
				if(OUT.innerText === undefined) OUT.textContent = output;
				else OUT.innerText = output;
				if(typeof console !== 'undefined') console.log("output", new Date());
			};
		})();
		
		
		
		var do_file = (function() {
			var rABS = typeof FileReader !== "undefined" && (FileReader.prototype||{}).readAsBinaryString;
			var domrabsChecked = true;
			var use_worker = typeof Worker !== 'undefined';
			var domworkChecked = true;
		
			var xw = function xw(data, cb) {
				
				var worker = new Worker(XW.worker);
				worker.onmessage = function(e) {
					switch(e.data.t) {
						case 'ready': break;
						case 'e': console.error(e.data.d); break;
						case XW.msg: 
							cb(JSON.parse(e.data.d));
							console.log(JSON.parse(e.data.d));
							swal("Good job!", "Loading Finished!", "success")
							break;
					}	
				};
				worker.postMessage({d:data,b:rABS?'binary':'array'});
			};
		
			return function do_file(files) {
				rABS = domrabsChecked;
				use_worker = domworkChecked;
				var f = files[0];
				var reader = new FileReader();
				reader.onload = function(e) {
					if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
					var data = e.target.result;
					if(!rABS) data = new Uint8Array(data);
					if(use_worker) xw(data, process_wb);
					else process_wb(X.read(data, {type: rABS ? 'binary' : 'array'}));
				};
				if(rABS) reader.readAsBinaryString(f);
				else reader.readAsArrayBuffer(f);
			};
		})();
		
		(function() {
			var xlf = document.getElementById('xlf');
			if(!xlf.addEventListener) return;
			function handleFile(e) { 
				//loading 표시
				swal({
					title: 'Loading...',
					imageUrl: 'resources/img/loading.gif',
					imageSize: '400x400',
					imageAlt: 'Custom image',
					animation: false
				});
				
				do_file(e.target.files); 
			}
			xlf.addEventListener('change', handleFile, false);
		})();
		
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-36810333-1']);
			_gaq.push(['_trackPageview']);
		
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</body>
</html>
